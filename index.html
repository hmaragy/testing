<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Website</title>
  </head>
  <body>
    HELLO

    <script>
      var SCRIPT1 = "./script1.js"; //or const SCRIPT1 = function() {  //YOUR SCRIPT  }
      var SCRIPT2 = "./script2.js"; //or const SCRIPT2 = function() { //YOUR SCRIPT}
      var CLIENT_PREFERNECES_JSON = "./CLIENT_PREFERNECES.json";

      var DAYS = ["MON", "TUE", "WED", "THU", "FRI", "SAT", "SUN"];
      var REQUEST_TRY_COUNT = 3;

      function sendRequest(url, callBack) {
        if ("fetch" in window && "Promise" in window) {
          fetch(url, {
            cache: "no-cache",
          })
            .then(function (response) {
              return response.json();
            })
            .then(function (result) {
              callBack(JSON.stringify(result));
            })
            .catch(function (error) {
              callBack(null, error);
            });
        } else {
          var httpRequest = new XMLHttpRequest();
          try {
            httpRequest.onreadystatechange = function requestHandler() {
              if (httpRequest.readyState === XMLHttpRequest.DONE) {
                if (httpRequest.status === 200) {
                  callBack(httpRequest.response);
                } else {
                  callBack(null);
                }
              }
            };
          } catch (e) {
            if (REQUEST_TRY_COUNT-- > 0) {
              sendRequest(url, callBack);
            }
          }
          httpRequest.open("GET", url, true);
          httpRequest.setRequestHeader("Access-Control-Allow-Origin", "*");
          httpRequest.setRequestHeader("Cache-Control", "no-cache");
          httpRequest.send();
        }
      }

      function runScript(s) {
        if (typeof s === "string") {
          var script = document.createElement("script");
          script.src = s;
          document.getElementsByTagName("head")[0].appendChild(script);
        } else {
          s();
        }
      }

      function getCurrentTime(callBack) {
        REQUEST_TRY_COUNT = 3;
        sendRequest("https://worldtimeapi.org/api/timezone/america/new_york", function (response) {
          if (response) {
            var responseObj = JSON.parse(response);
            callBack({
              day: DAYS[parseInt(responseObj.day_of_week, 10) - 1],
              hour: parseInt(responseObj.datetime.split("T")[1].split(":")[0], 10),
              minute: parseInt(responseObj.datetime.split("T")[1].split(":")[1], 10),
            });
          } else {
            //For Old and Obsolete browsers, or incase of an issue in internet time API:
            //Old browsers requires you to adjust your PC time from the internet. but time is in GMT.
            //In that case, we'll just convert from GMT to EST.
            var date = new Date();
            var dateDaylightStart = new Date("March 14, 2021");
            var dateDaylightEnd = new Date("November 7, 2021");

            var offset = date.getTimezoneOffset() / 60;

            if (date >= dateDaylightStart && date < dateDaylightEnd) {
              //Nothing
            } else {
              offset += 1;
            }
            var minutes = date.getMinutes();
            var hours = (date.getHours() + offset - 4) % 24;
            var dayOffset = 0;
            if (date.getHours() + offset - 4 < 0) {
              dayOffset = 1;
            } else if (date.getHours() + offset - 4 >= 24) {
              dayOffset = -1;
            }
            callBack({
              day: DAYS[new Date().getDay() - 1 - dayOffset],
              hour: hours,
              minute: minutes,
            });
          }
        });
      }
      function getClientPreferneces(currentTime) {
        var hour = currentTime.hour;
        var minute = currentTime.minute;
        var time = new Date("01/01/2021 " + hour + ":" + minute);
        var currentDay = currentTime.day;
        REQUEST_TRY_COUNT = 3;
        sendRequest(CLIENT_PREFERNECES_JSON, function (response) {
          if (response) {
            var responseObj = JSON.parse(response);
            var prefTime = responseObj.activeTime[currentDay] || [];
            var timeInBetween = false;
            for (var i = 0; i < prefTime.length; i++) {
              var t = prefTime[i];
              var from = new Date("01/01/2021 " + t.FROM);
              var to = new Date("01/01/2021 " + t.TO);
              if ((time >= from && time < to) || (from > to && time > from) || (from > to && time < to)) {
                timeInBetween = true;
                break;
              }
            }
            if (timeInBetween) {
              runScript(SCRIPT1);
            } else {
              runScript(SCRIPT2);
            }
          } else {
            runScript(SCRIPT2);
          }
        });
      }

      function runScriptsConditionally() {
        getCurrentTime(getClientPreferneces);
      }

      runScriptsConditionally(getClientPreferneces);
    </script>
  </body>
</html>
